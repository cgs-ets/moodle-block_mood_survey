{"version":3,"sources":["../src/controls.js"],"names":["define","$","Log","Ajax","MoodSurveyControl","region","instanceid","isstudent","self","prototype","main","on","e","preventDefault","option","saveSurveyResponse","css","find","removeAttr","text","addClass","removeClass","children","each","attr","first","saveOptOut","call","methodname","args","done","response","html","delay","fadeOut","debug","fail","reason","error","hasClass","question","closest","questionid","data","questiontitle","completed","message","init","length","control"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Provides the block_mood_survey/control module\n *\n * @package   block_mood_survey\n * @category  output\n * @copyright 2020 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * @module block_mood_survey/control\n */\ndefine(['jquery', 'core/log', 'core/ajax'], function ($, Log, Ajax) {\n    'use strict';\n\n    /**\n     * Initializes the block controls.\n     */\n    function init(instanceid, isstudent) {\n        Log.debug('block_mood_survey/control: initializing controls of the block_mood_survey block instance ' + instanceid);\n\n        var region = $('[data-region=\"block_mood_survey-instance-' + instanceid + '\"]').first();\n\n        if (!region.length) {\n            Log.debug('block_mood_survey/control: wrapping region not found!');\n            return;\n        }\n\n        var control = new MoodSurveyControl(region, instanceid, isstudent);\n        control.main();\n    }\n\n    // Constructor.\n    function MoodSurveyControl(region, instanceid, isstudent) {\n        var self = this;\n        self.region = region;\n        self.instanceid = instanceid;\n        self.isstudent = isstudent;\n    }\n\n    MoodSurveyControl.prototype.main = function () {\n        var self = this;\n\n        // Handle answer click.\n        self.region.on('click', '.answer .option', function (e) {\n            e.preventDefault();\n            var option = $(this);\n            self.saveSurveyResponse(option);\n        });\n\n        // Display more\n        self.region.on('click', '.survey-more', function (e) {\n            $(\"#answersbody\").css('text-align', 'justify');\n            $(\"#answersbody\").find('a').removeAttr('data-original-title'); //remove tooltips\n            $(\"#answersbody\").find('span').css('display', 'inline'); // display label\n\n            //Display help\n            ($(\"#answersbody\").find('.help')).css('display', 'inline');\n            this.text = 'Less...';\n            $(this).addClass('survey-less');\n            $(this).removeClass('survey-more');\n            return false;\n        });\n\n        // Display less\n        self.region.on('click', '.survey-less', function (e) {\n            ($(\"#answersbody\").find('.help')).css('display', 'none');\n            ($(\"#answersbody\").find('span')).css('display', 'none');\n\n            $(\"#answersbody\").children().each(function (index) {\n                $(this).attr('data-original-title', $(this).first().text()); //Add tooltips\n            });\n            this.text = 'More...';\n            $(this).removeClass('survey-less');\n            $(this).addClass('survey-more');\n            \n        });\n\n        // Opt out\n        self.region.on('click', '.survey-opt-out', function (e) {\n            e.preventDefault();\n            self.saveOptOut();//2 = opt out\n           // self.region.remove();\n        });\n    };\n\n\n    MoodSurveyControl.prototype.saveOptOut = function () {\n        var self = this;\n\n        Ajax.call([{\n                methodname: 'block_mood_survey_save_opt_out',\n                args: {\n                },\n                done: function (response) {\n                    self.region.find('.survey').html('<h3>Thank you</h3>');\n                    self.region.delay(2000).fadeOut(400);\n                    Log.debug(response);\n                },\n                fail: function (reason) {\n                    Log.error(reason);\n                }\n            }]);\n\n    }\n\n    MoodSurveyControl.prototype.saveSurveyResponse = function (option) {\n        var self = this;\n\n        // Check if already submiting.\n        if (self.region.hasClass('submitting')) {\n            return;\n        }\n\n        var question = option.closest('.question');\n        var questionid = question.data('id');\n        var questiontitle = question.data('title');\n        var response = option.data('value');\n        // Remove tooltip\n        $('body').find('.tooltip').css('display', 'none');\n\n        if (questionid == null || questiontitle == null || response == null) {\n            return;\n        }\n\n        self.region.addClass('submitting');\n        question.addClass('submitting');\n        option.addClass('submitting');\n\n        Ajax.call([{\n                methodname: 'block_mood_survey_save_survey_response',\n                args: {\n                    questionid: questionid,\n                    questiontitle: questiontitle,\n                    response: response\n                },\n                done: function (response) {\n                    if (response.completed) {\n                        self.region.find('.survey').html(response.message);\n                        self.region.delay(2000).fadeOut(400);\n                    }\n                },\n                fail: function (reason) {\n                    self.region.find('.survey').html('<h3>Error: Failed to save survey response.</h3>');\n                    Log.error(reason);\n                }\n            }]);\n    }\n\n    return {\n        init: init\n    };\n});"],"file":"controls.min.js"}
